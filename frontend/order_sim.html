<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIM/Data မှာယူရန်</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f4f4f9; }
        .form-input { border-radius: 8px; border: 1px solid #e5e7eb; padding: 12px; width: 100%; }
        .btn-primary { background-color: #4f46e5; }
        .btn-primary:hover { background-color: #4338ca; }
    </style>
</head>
<body class="min-h-screen">
    <div class="max-w-md mx-auto p-4 pt-8">
        <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">SIM/Data မှာယူရန်</h1>

        <form id="orderForm" class="bg-white p-6 rounded-xl shadow-xl">
            <input type="hidden" name="action" value="submit_sim_game">
            <input type="hidden" name="orderType" value="SIM">

            <div class="mb-4">
                <label for="provider" class="block text-sm font-medium text-gray-700 mb-1">ဝန်ဆောင်မှုပေးသူ (Provider)</label>
                <select id="provider" name="provider" required class="form-input">
                    <option value="">ရွေးချယ်ပါ</option>
                    <option value="MPT">MPT</option>
                    <option value="Ooredoo">Ooredoo</option>
                    <option value="Telenor (Atom)">Telenor (Atom)</option>
                    <option value="Mytel">Mytel</option>
                </select>
            </div>
            
            <div class="mb-4">
                <label for="package" class="block text-sm font-medium text-gray-700 mb-1">ပက်ကေ့ချ် (Package)</label>
                <input type="text" id="package" name="package" required placeholder="ဥပမာ။ 5000Ks - 5GB - 7Days" class="form-input">
            </div>

            <div class="mb-4">
                <label for="phoneNumber" class="block text-sm font-medium text-gray-700 mb-1">ဖုန်းနံပါတ် (Phone Number)</label>
                <input type="tel" id="phoneNumber" name="phoneNumber" required placeholder="09xxxxxxxxx" class="form-input">
            </div>

            <div class="mb-4">
                <label for="total" class="block text-sm font-medium text-gray-700 mb-1">ကျသင့်ငွေ (Total)</label>
                <input type="tel" id="total" name="total" required placeholder="ကျသင့်ငွေ (Ks)" min="1" class="form-input">
            </div>

            <div class="mb-4">
                <label for="paymentMethod" class="block text-sm font-medium text-gray-700 mb-1">ငွေပေးချေမှုစနစ်</label>
                <select id="paymentMethod" name="paymentMethod" required class="form-input">
                    <option value="">ရွေးချယ်ပါ</option>
                    <option value="KBZ Pay">KBZ Pay</option>
                    <option value="Wave Pay">Wave Pay</option>
                    <option value="AYA Pay">AYA Pay</option>
                    <option value="Other">အခြား</option>
                </select>
            </div>

            <div class="mb-4">
                <label for="transactionId" class="block text-sm font-medium text-gray-700 mb-1">ငွေလွှဲပြေစာ ID / မှတ်စု</label>
                <input type="text" id="transactionId" name="transactionId" required placeholder="ငွေလွှဲပြေစာ ID သို့မဟုတ် ၄ လုံး" class="form-input">
            </div>

            <div class="mb-6">
                <label for="fileUpload" class="block text-sm font-medium text-gray-700 mb-1">ငွေလွှဲပြေစာ ပုံ (Optional)</label>
                <input type="file" id="fileUpload" name="fileUpload" accept="image/*" class="form-input p-2 bg-gray-50">
            </div>

            <button type="submit" id="submitButton" class="btn-primary w-full py-3 rounded-xl text-white font-semibold shadow-md hover:shadow-lg transition duration-200">
                မှာယူရန် / ပို့ရန်
            </button>

            <p id="loadingMessage" class="hidden text-center text-indigo-600 mt-3 font-semibold">
                အချက်အလက်များ ပို့နေပါသည်...
            </p>
        </form>

        <a href="index.html" class="block text-center mt-6 text-indigo-500 hover:text-indigo-600 transition duration-150 font-medium">
            &larr; ပင်မစာမျက်နှာသို့
        </a>
    </div>

    <script>
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyTg-sSZg6QIrLT5WZYckUNU33dVuxn6H9vFMbhTvJnKBidfnTg8YLLKp7Ro73rhgZAGw/exec';
        const maintenanceUrl = 'closed_today_20251114.html';

        function checkMaintenance() {
            // In a real scenario, this would check a status flag in GAS
            const isMaintenance = false; 
            if (isMaintenance) {
                window.location.href = maintenanceUrl;
                return true;
            }
            return false;
        }
        if (checkMaintenance()) { }

        function getUserId() {
            let userId = localStorage.getItem('easyRechargeUserId');
            if (!userId) {
                userId = 'GUEST-' + Math.random().toString(36).substring(2, 9).toUpperCase();
                localStorage.setItem('easyRechargeUserId', userId);
            }
            return userId;
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-5 left-1/2 transform -translate-x-1/2 p-3 rounded-xl shadow-2xl text-white text-sm font-semibold transition-opacity duration-300 z-50`;
            
            if (type === 'success') {
                toast.classList.add('bg-green-600');
            } else if (type === 'error') {
                toast.classList.add('bg-red-600');
            } else {
                toast.classList.add('bg-gray-700');
            }

            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        document.getElementById('orderForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            document.getElementById('submitButton').disabled = true;
            document.getElementById('loadingMessage').classList.remove('hidden');

            const formData = new FormData(this);
            formData.append('auth_token', getUserId());

            try {
                const response = await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) throw new Error('Network error or GAS script failed.');
                
                const resultText = await response.text();
                let result;
                try {
                    result = JSON.parse(resultText);
                } catch (e) {
                    throw new Error('Invalid JSON response: ' + resultText);
                }

                if (result.status === 'success') {
                    showToast(`မှာယူမှု အောင်မြင်ပါသည်။ Order ID: ${result.orderId}`, 'success');
                    this.reset();
                    // Optional: Redirect to status page
                    setTimeout(() => window.location.href = 'status.html', 2000);
                } else {
                    showToast(`မှာယူမှု မအောင်မြင်ပါ: ${result.message}`, 'error');
                }

            } catch (error) {
                console.error('Submission Error:', error);
                showToast(`ချိတ်ဆက်မှု ပြဿနာ: ${error.message}`, 'error');
            } finally {
                document.getElementById('submitButton').disabled = false;
                document.getElementById('loadingMessage').classList.add('hidden');
            }
        });
    </script>
</body>
</html>

              
